{"filter":false,"title":"main.js","tooltip":"/dataapi/routes/main.js","undoManager":{"mark":4,"position":4,"stack":[[{"start":{"row":0,"column":0},"end":{"row":46,"column":2},"action":"insert","lines":["const express = require(\"express\")","const router = express.Router()","const mongoose = require(\"mongoose\")","const request = require(\"request\")","const moment = require(\"moment\")","const dateutil = require(\"data-utils\")","const mongoClient = require(\"mongodb\").MongoClient","","let day = new Date().toLocaleDateString('sv').replaceAll('-','');","","var keys = \"B%2FNiJnYmkZV1%2FK7ulvZI4MoSXvCTDfNAd0Snw%2Bk6g4%2BbMk1LoGVhd75DJahjv4K35Cr9jh9RX0j%2BM89grKBYsw%3D%3D\";","var url = \"http://apis.data.go.kr/1360000/WthrChartInfoService/getSurfaceChart\";","","var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + keys;","queryParams += '&' + encodeURIComponent('pageNo') + '=' + encodeURIComponent('1');","queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('10');","queryParams += '&' + encodeURIComponent('dataType') + '=' + encodeURIComponent('JSON');","queryParams += '&' + encodeURIComponent('code') + '=' + encodeURIComponent('3');","queryParams += '&' + encodeURIComponent('time') + '=' + encodeURIComponent(day);","","// define schema","var DataSchema = mongoose.Schema({","    resultcode : String,","    resultMsg : String,","    dataType : String,","    Manfile : String","})","","// create model with mongodb collection and schema","var Data = mongoose.model('weather', DataSchema);","","// getdata","router.get('/getdata', function(req, res, next) {","    request({","            url : url + queryParams,","            method : \"GET\"","    }, function (error, response, body) {","        Data.find({}).remove().exec();","        if (error) console.log(error)","//        console.log('resultCode', response.resultCode);","//        console.log('Headers', JSON.stringify(response.headers));","        let data = JSON.parse(body)","        console.log(data['response']['body']['items']['item'])","        res.json(data)","","    })","})"],"id":1}],[{"start":{"row":10,"column":12},"end":{"row":10,"column":114},"action":"remove","lines":["B%2FNiJnYmkZV1%2FK7ulvZI4MoSXvCTDfNAd0Snw%2Bk6g4%2BbMk1LoGVhd75DJahjv4K35Cr9jh9RX0j%2BM89grKBYsw%3D%3D"],"id":2},{"start":{"row":10,"column":12},"end":{"row":10,"column":112},"action":"insert","lines":["X6B4L8ImAS4MDktlIVLKb9%2B6XcoW%2Bu0jaAae%2F7Y3WLJ1KT9OEdyPLjEnVgPVlWObXotHE7QKeve7LCBmKS%2B7Iw%3D%3D"]}],[{"start":{"row":11,"column":11},"end":{"row":11,"column":78},"action":"remove","lines":["http://apis.data.go.kr/1360000/WthrChartInfoService/getSurfaceChart"],"id":3},{"start":{"row":11,"column":11},"end":{"row":11,"column":78},"action":"insert","lines":["http://apis.data.go.kr/1360000/WthrChartInfoService/getSurfaceChart"]}],[{"start":{"row":46,"column":2},"end":{"row":47,"column":0},"action":"insert","lines":["",""],"id":4}],[{"start":{"row":47,"column":0},"end":{"row":47,"column":24},"action":"insert","lines":["module.exports = router;"],"id":5}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":18,"column":80},"end":{"row":18,"column":80},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1670565736736,"hash":"04b86ce82b449daf11f2131dc40b1b21eb75f36a"}